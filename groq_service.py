from groq import AsyncGroq
from config import GROQ_API_KEY, GROQ_MODEL, GROQ_MAX_TOKENS
from typing import Dict, List, Union
import json
import re
import logging

client = AsyncGroq(api_key=GROQ_API_KEY)
logger = logging.getLogger(__name__)

class GroqService:
    
    # --- –ë–ê–ó–û–í–´–ô –ú–ï–¢–û–î –ó–ê–ü–†–û–°–ê ---
    @staticmethod
    async def _send_groq_request(system_prompt: str, user_text: str, temperature: float = 0.5, max_tokens: int = 1500) -> str:
        try:
            response = await client.chat.completions.create(
                model=GROQ_MODEL,
                messages=[
                    {"role": "system", "content": system_prompt},
                    {"role": "user", "content": user_text}
                ],
                max_tokens=max_tokens,
                temperature=temperature
            )
            return response.choices[0].message.content.strip()
        except Exception as e:
            logger.error(f"Groq API Error: {e}")
            return ""

    # --- –õ–û–ì–ò–ö–ê ---

    @staticmethod
    async def validate_ingredients(text: str) -> bool:
        prompt = """–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –º–æ–¥–µ—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤.
        –í–µ—Ä–Ω–∏ JSON: {"valid": true} –ï–°–õ–ò –≤ —Ç–µ–∫—Å—Ç–µ —Å—ä–µ–¥–æ–±–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã.
        –í–µ—Ä–Ω–∏ JSON: {"valid": false} –ï–°–õ–ò –±–µ—Å—Å–º—ã—Å–ª–∏—Ü–∞, –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏–ª–∏ –Ω–µ—Å—ä–µ–¥–æ–±–Ω—ã–µ/–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã.
        –í–ï–†–ù–ò –¢–û–õ–¨–ö–û JSON."""
        
        res = await GroqService._send_groq_request(prompt, f"–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π: \"{text}\"", 0.1)
        return "true" in res.lower()

    @staticmethod
    async def analyze_categories(products: str) -> List[str]:
        """
        –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–ª—é–¥ –∏–∑ —ç—Ç–æ–≥–æ –†–ï–ê–õ–¨–ù–û –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å.
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π: ['soup', 'main', 'salad', 'dessert', 'drink', 'snack', 'mix']
        """
        # –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–≥—Ä—É–±–æ –ø–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º)
        items_count = len(re.split(r'[,;]', products))
        
        # –ï—Å–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ (>=5), —Ä–∞–∑—Ä–µ—à–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é Mix
        allow_mix = items_count >= 5
        mix_prompt = "- 'mix' (–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –æ–±–µ–¥ - —Å–µ—Ç –∏–∑ 2-3 –±–ª—é–¥)" if allow_mix else ""

        prompt = f"""–¢—ã –æ–ø—ã—Ç–Ω—ã–π —à–µ—Ñ-–ø–æ–≤–∞—Ä. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: "{products}".
        
        –û–ø—Ä–µ–¥–µ–ª–∏, –∫–∞–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–ª—é–¥ –∏–∑ —ç—Ç–æ–≥–æ –ú–û–ñ–ù–û –†–ï–ê–õ–¨–ù–û –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å (–∏–º–µ—è –±–∞–∑–æ–≤—ã–µ —Å–æ–ª—å/–≤–æ–¥—É/–ø–æ–¥—Å–æ–ª–Ω–µ—á–Ω–æ–µ –º–∞—Å–ª–æ/—Å–∞—Ö–∞—Ä/–ª—ë–¥).
           
        –í–æ–∑–º–æ–∂–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
        - "soup" (—Å—É–ø—ã)
        - "main" (–≤—Ç–æ—Ä—ã–µ –±–ª—é–¥–∞)
        - "salad" (—Å–∞–ª–∞—Ç—ã)
        - "breakfast" (–∑–∞–≤—Ç—Ä–∞–∫–∏)
        - "dessert" (–¥–µ—Å–µ—Ä—Ç—ã - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–∞—Ö–∞—Ä/—Ñ—Ä—É–∫—Ç—ã/–º—É–∫–∞)
        - "drink" (–Ω–∞–ø–∏—Ç–∫–∏ - –µ—Å–ª–∏ –µ—Å—Ç—å —Ñ—Ä—É–∫—Ç—ã/–º–æ–ª–æ–∫–æ/—è–≥–æ–¥—ã)
        - "snack" (–∑–∞–∫—É—Å–∫–∏)
        {mix_prompt}
        
        –ü–†–ê–í–ò–õ–û: –ï—Å–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –º–∞–ª–æ, –≤–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ —Å–∞–º—É—é –ø–æ–¥—Ö–æ–¥—è—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é.
        –ï—Å–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –º–Ω–æ–≥–æ, –≤–µ—Ä–Ω–∏ 3-4 —Å–∞–º—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ.
        
        –í–ï–†–ù–ò –¢–û–õ–¨–ö–û JSON —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π.
        –ü—Ä–∏–º–µ—Ä: ["main", "salad", "drink"]
        """
        
        res = await GroqService._send_groq_request(prompt, "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏", 0.2)
        
        try:
            clean_json = res.replace("```json", "").replace("```", "").strip()
            data = json.loads(clean_json)
            if isinstance(data, list):
                # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞: –µ—Å–ª–∏ AI –≤–µ—Ä–Ω—É–ª mix, –Ω–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –º–∞–ª–æ - —É–±–∏—Ä–∞–µ–º
                if "mix" in data and not allow_mix:
                    data.remove("mix")
                return data
        except Exception as e:
            logger.error(f"Category JSON Error: {e}")
            pass
        
        return ["main"]

    @staticmethod
    async def generate_dishes_list(products: str, category: str) -> List[Dict[str, str]]:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ –±–ª—é–¥.
        –î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ 'mix' —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–µ—Ç—ã.
        """
        items_count = len(re.split(r'[,]', products))
        
        if items_count <= 2:
            target_count = "2-3"
        elif items_count <= 5:
            target_count = "4-5"
        else:
            target_count = "5-6"

        cat_names = {
            "soup": "–°—É–ø—ã", "main": "–í—Ç–æ—Ä—ã–µ –±–ª—é–¥–∞", "salad": "–°–∞–ª–∞—Ç—ã", 
            "breakfast": "–ó–∞–≤—Ç—Ä–∞–∫–∏", "dessert": "–î–µ—Å–µ—Ä—Ç—ã", "drink": "–ù–∞–ø–∏—Ç–∫–∏", 
            "snack": "–ó–∞–∫—É—Å–∫–∏", "mix": "–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ –æ–±–µ–¥—ã"
        }
        cat_ru = cat_names.get(category, "–ë–ª—é–¥–∞")

        # –†–∞–∑–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–º—Ç–∞ –¥–ª—è MIX –∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
        if category == "mix":
            prompt = f"""üìù –ó–ê–î–ê–ù–ò–ï: –°–æ—Å—Ç–∞–≤—å –º–µ–Ω—é –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –æ–±–µ–¥" (Mix).
            –≠—Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –∏–∑ 2-3 –±–ª—é–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –°—É–ø + –°–∞–ª–∞—Ç, –í—Ç–æ—Ä–æ–µ + –ù–∞–ø–∏—Ç–æ–∫).
            
            üõí –ü–†–û–î–£–ö–¢–´: {products}
            üî¢ –ü—Ä–µ–¥–ª–æ–∂–∏: {target_count} –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∫–æ–º–ø–ª–µ–∫—Å–æ–≤.
            
            –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
            1. –ö–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç ‚Äî —ç—Ç–æ –°–ï–¢.
            2. –ù–∞–∑–≤–∞–Ω–∏–µ (name) –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–º (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–û–±–µ–¥ –§–µ—Ä–º–µ—Ä—Å–∫–∏–π").
            3. –í –æ–ø–∏—Å–∞–Ω–∏–∏ (desc) —É–∫–∞–∂–∏ —Å–æ—Å—Ç–∞–≤: "–ë–æ—Ä—â + –ü—é—Ä–µ —Å –∫–æ—Ç–ª–µ—Ç–æ–π".
            
            –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (–°–¢–†–û–ì–û JSON):
            [
                {{"name": "–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ç–∞", "desc": "–°–æ—Å—Ç–∞–≤: –ë–ª—é–¥–æ 1 + –ë–ª—é–¥–æ 2. –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ."}}
            ]
            """
        else:
            prompt = f"""üìù –ó–ê–î–ê–ù–ò–ï: –ü—Ä–∏–¥—É–º–∞–π –º–µ–Ω—é –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "{cat_ru}"
            üõí –ü–†–û–î–£–ö–¢–´: {products}
            üî¢ –ü—Ä–µ–¥–ª–æ–∂–∏: {target_count} –≤–∫—É—Å–Ω—ã—Ö –±–ª—é–¥.
            
            –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (–°–¢–†–û–ì–û JSON):
            [
                {{"name": "–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞", "desc": "–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ"}}
            ]
            """
        
        res = await GroqService._send_groq_request(prompt, "–ü—Ä–µ–¥–ª–æ–∂–∏ –º–µ–Ω—é JSON", 0.5)
        
        try:
            clean_json = res.replace("```json", "").replace("```", "").strip()
            data = json.loads(clean_json)
            if isinstance(data, list):
                return data
        except Exception as e:
            logger.error(f"Dishes JSON Error: {e}")
        return []

    @staticmethod
    async def determine_intent(user_message: str, dish_list: str) -> Dict:
        """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ, —Ö–æ—Ç—è –≤ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ –∫–Ω–æ–ø–æ–∫ —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∂–µ"""
        prompt = f"""–ö–æ–Ω—Ç–µ–∫—Å—Ç: {dish_list}
        –°–æ–æ–±—â–µ–Ω–∏–µ: "{user_message}"
        –û–ø—Ä–µ–¥–µ–ª–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ:
        1. "add_products" (–¥–æ–±–∞–≤–∏–ª –ø—Ä–æ–¥—É–∫—Ç—ã)
        2. "select_dish" (–Ω–∞–∑–≤–∞–ª –±–ª—é–¥–æ —Ç–µ–∫—Å—Ç–æ–º)
        3. "unclear"
        JSON: {{"intent": "...", "products": "...", "dish_name": "..."}}"""

        res = await GroqService._send_groq_request(prompt, "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π", 0.1)
        
        try:
            start = res.find('{')
            end = res.rfind('}')
            if start != -1 and end != -1:
                return json.loads(res[start : end + 1])
        except Exception:
            pass
        return {"intent": "unclear"}
            
    @staticmethod
    async def generate_recipe(dish_name: str, products: str) -> str:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ—Ü–µ–ø—Ç.
        –ï—Å–ª–∏ —ç—Ç–æ MIX, –ø—Ä–æ—Å–∏—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã.
        """
        # –ü—Ä–æ–≤–µ—Ä–∫–∞, –ø–æ—Ö–æ–∂ –ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ç
        is_mix = any(x in dish_name.lower() for x in ["–æ–±–µ–¥", "–ª–∞–Ω—á", "—É–∂–∏–Ω", "—Å–µ—Ç", "–∫–æ–º–ø–ª–µ–∫—Å", "+"])
        
        mix_instruction = ""
        if is_mix:
            mix_instruction = """
            ‚ö†Ô∏è –≠–¢–û –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –û–ë–ï–î (–ù–ï–°–ö–û–õ–¨–ö–û –ë–õ–Æ–î).
            –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ì–†–ê–ú–û–¢–ù–û –†–ê–°–ü–†–ï–î–ï–õ–ò–¢–¨ –∏–º–µ—é—â–∏–µ—Å—è –ø—Ä–æ–¥—É–∫—Ç—ã –º–µ–∂–¥—É –±–ª—é–¥–∞–º–∏ —Å–µ—Ç–∞.
            –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫—É—Å–æ–∫ –º—è—Å–∞ –∏–ª–∏ –æ–≤–æ—â –¥–≤–∞–∂–¥—ã, –µ—Å–ª–∏ –µ–≥–æ –º–∞–ª–æ.
            –†–∞—Å–ø–∏—à–∏ —Ä–µ—Ü–µ–ø—Ç –∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–ª—è –ö–ê–ñ–î–û–ì–û –±–ª—é–¥–∞ –∏–∑ —Å–µ—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ.
            """

        prompt = f"""–ù–∞–ø–∏—à–∏ –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç: "{dish_name}".
        
        üõí –ò–°–ü–û–õ–¨–ó–£–ô –¢–û–õ–¨–ö–û –≠–¢–ò –ü–†–û–î–£–ö–¢–´: {products}
        üßÇ –ë–ê–ó–ê: —Å–æ–ª—å, –≤–æ–¥–∞, –º–∞—Å–ª–æ, —Å–∞—Ö–∞—Ä, –ª–µ–¥
        
        {mix_instruction}

        **–ü–†–ê–í–ò–õ–ê:**
        1. –ì–æ—Ç–æ–≤–∏–º –°–¢–†–û–ì–û –∏–∑ –∏–º–µ—é—â–∏—Ö—Å—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤.
        2. –ë–µ—Ä–∏ –¢–û–õ–¨–ö–û –Ω—É–∂–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã.
        3. –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è: –≥—Ä, —à—Ç, —Å—Ç.–ª.
        
        **–§–û–†–ú–ê–¢ –í–´–í–û–î–ê:**
        ## [–ù–∞–∑–≤–∞–Ω–∏–µ]
        
        üì¶ –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:
        (–ï—Å–ª–∏ —ç—Ç–æ —Å–µ—Ç ‚Äî —Ä–∞–∑–¥–µ–ª–∏ —Å–ø–∏—Å–∫–∏: "–î–ª—è —Å—É–ø–∞:", "–î–ª—è –≤—Ç–æ—Ä–æ–≥–æ:")
        * [–ü—Ä–æ–¥—É–∫—Ç] ‚Äî [–∫–æ–ª-–≤–æ];
        
        üìä –ö–ë–ñ–£ –Ω–∞ 1 –ø–æ—Ä—Ü–∏—é (–≤—Å–µ–≥–æ –æ–±–µ–¥–∞):
        –ë–µ–ª–∫–∏: X, –ñ–∏—Ä—ã: X, –£–≥–ª–µ–≤–æ–¥—ã: X, –ö–∫–∞–ª: X
        
        ‚è∞ –í—Ä–µ–º—è: X –º–∏–Ω | –°–ª–æ–∂–Ω–æ—Å—Ç—å: ... | –ü–æ—Ä—Ü–∏–∏: X
        
        üë®‚Äçüç≥ –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:
        (–ï—Å–ª–∏ —Å–µ—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª—é–¥–∞)
        1. ...
        
        üí° –°–æ–≤–µ—Ç –æ—Ç —à–µ—Ñ–∞ (–ö—É–ª–∏–Ω–∞—Ä–Ω–∞—è —Ç—Ä–∏–∞–¥–∞):
        [–ê–Ω–∞–ª–∏–∑ –±–∞–ª–∞–Ω—Å–∞ –≤–∫—É—Å–æ–≤ –∏ –û–î–ò–ù —Å–æ–≤–µ—Ç –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞]
        """

        res = await GroqService._send_groq_request(prompt, "–ù–∞–ø–∏—à–∏ —Ä–µ—Ü–µ–ø—Ç", 0.4)
        if GroqService._is_refusal(res): 
            return res
        return res + "\n\nüë®‚Äçüç≥ <b>–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∞–ø–ø–µ—Ç–∏—Ç–∞!</b>"

    @staticmethod
    async def generate_freestyle_recipe(dish_name: str) -> str:
        # –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã —Ñ–∞–π–ª–∞ –æ—Å—Ç–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥
        prompt = f"""–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç —Ä–µ—Ü–µ–ø—Ç: "{dish_name}".
        1. –ï—Å–ª–∏ –ï–î–ê -> –†–µ—Ü–µ–ø—Ç —Å –ö–ë–ñ–£.
        2. –ï—Å–ª–∏ –ú–ï–¢–ê–§–û–†–ê -> –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π —Ä–µ—Ü–µ–ø—Ç.
        3. –ï—Å–ª–∏ –ó–ê–ü–†–ï–©–ï–ù–ö–ê -> –û—Ç–∫–∞–∑.
        
        –§–æ—Ä–º–∞—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π (–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã, –ö–ë–ñ–£, –í—Ä–µ–º—è, –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ, –°–æ–≤–µ—Ç).
        """
        res = await GroqService._send_groq_request(prompt, "–ù–∞–ø–∏—à–∏ —Ä–µ—Ü–µ–ø—Ç", 0.6)
        if GroqService._is_refusal(res): 
            return res
        return res + "\n\nüë®‚Äçüç≥ <b>–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∞–ø–ø–µ—Ç–∏—Ç–∞!</b>"

    @staticmethod
    def _is_refusal(text: str) -> bool:
        if "‚õî" in text: return True
        refusals = ["cannot fulfill", "cannot answer", "against my policy", "–Ω–µ –º–æ–≥—É –æ—Ç–≤–µ—Ç–∏—Ç—å", "–Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞"]
        for ph in refusals:
            if ph in text.lower(): return True
        return False